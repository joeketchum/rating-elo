<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Rating Game ❤️</title>
</head>
<body>
  <div id="app"></div>

  <!-- Load compiled Elm once -->
  <script src="./elm.js"></script>

  <script>
    // For Browser.document, DO NOT pass { node: ... }
    const app = Elm.Main.init({ flags: null });

    // Apps Script write URL
    const SAVE_URL = "https://script.google.com/macros/s/AKfycbxc5UWCVkDzwOy2MwkHpxkPb8H6PIoVIPQRSw72wRyIHdTBaUi81TvDglWpVEeP79VKiw/exec"; 
    // If you added a secret in your Apps Script, append it:
    // const SAVE_URL = "https://script.google.com/macros/s/.../exec?secret=YOUR_SECRET";

    // Wire the save port
    if (app.ports && app.ports.saveToPublicDrive) {
      app.ports.saveToPublicDrive.subscribe(async (jsonText) => {
        try {
          const res = await fetch(SAVE_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" }, // simple => no preflight
            body: jsonText
          });
          const ts = new Date().toLocaleString();
          app.ports.receivePublicDriveStatus?.send(`Saved to Drive|${ts}`);
          console.log("Save status:", res.status);
        } catch (e) {
          app.ports.receivePublicDriveStatus?.send("Save failed");
          console.error("Save failed:", e);
        }
      });
    }
  </script>
</body>
</html>
